<!DOCTYPE html>
<html>
  <head>
    <script>
	function init(){
  document.getElementById('fileInput').addEventListener('change', handleFileSelect, false);
}

var originalFileName = "";
function handleFileSelect(event){
  const reader = new FileReader()
  var file = event.target.files[0];
  reader.readAsText(file)
  originalFileName = file.name;
  reader.onload = handleFileLoad;
}

function handleFileLoad(event, x){
  console.log(event);
  var parser = new DOMParser();
  var xmlDoc = parser.parseFromString(event.target.result,"text/xml");
  var trkseg = xmlDoc.firstChild.getElementsByTagName("trk")[0].getElementsByTagName("trkseg")[0];
  var reverse = Array.from(trkseg.children).reverse();
 
  for (var i =trkseg.childElementCount - 1; i >= 0; --i) {
    trkseg.children[i].remove();
  }
  reverse.forEach(element => {
    trkseg.appendChild(element); 
  });

  var originalMetaDataNameNode = xmlDoc.firstChild.getElementsByTagName("metadata")[0].getElementsByTagName("name")[0];
  if(originalMetaDataNameNode){
    originalMetaDataNameNode.textContent = "Reversed - " + originalMetaDataNameNode.textContent;
  }

  var originalTrkNameNode = xmlDoc.firstChild.getElementsByTagName("trk")[0].getElementsByTagName("name")[0];
  if(originalTrkNameNode){
    originalTrkNameNode.textContent = "Reversed - " + originalTrkNameNode.textContent;
  }

  var fileContent = new XMLSerializer().serializeToString(xmlDoc);
  fileContent = fileContent.replace(/(^[ \t]*\n)/gm, "")

  console.log(fileContent);
  download("reversed-"+originalFileName,fileContent);
}

function download(filename, text) { //https://www.bitdegree.org/learn/javascript-download
  var element = document.createElement('a');
  element.setAttribute('href', 'data:text/plain;charset=utf-8,' + encodeURIComponent(text));
  element.setAttribute('download', filename);

  element.style.display = 'none';
  document.body.appendChild(element);

  element.click();

  document.body.removeChild(element);
}
</script>
  </head>
  <h1>Reverse GPX file</h1>
This tool will reverse the GPX route you upload.<br />
The reversed file will download immediately.<br />

Happy exploring!<br />
- Jan<br /><br />

  <body onload="init()">
    <input id="fileInput" type="file" name="file" />
  </body>

  <h1>Troubles?</h1>
  If you have any issues, feel free to <a href="https://github.com/janmarques/gpx/issues">report them</a>.<br /> (This was tested with GPX files generated by Strava, and using the Google Chrome browser).
</html>
